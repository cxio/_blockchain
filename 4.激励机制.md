//////////////////////////////////////////////////////////////////////////////
Copyright (c) 2019 @cxio/blockchain

    Permission is granted to copy, distribute and/or modify this document
    under the terms of the GNU Free Documentation License, Version 1.3
    or any later version published by the Free Software Foundation;
    with no Invariant Sections, no Front-Cover Texts, and no Back-Cover Texts.
    A copy of the license is included in the section entitled "GNU
    Free Documentation License".
&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&


对于一个开放的公共区块链系统来说，参与者是完全自由的，没有激励手段，自发的参与不可能形成。

在Bitcoin系统中，激励的手段有铸币奖励和交易费获利。铸币就是铸造者可以按规定的数量凭空生成比特币，这也是比特币的来源。交易费是交易被纳入区块需要支付的费用，类似银行转账的手续费。两种收益构成了Bitcoin系统运行的经济支撑。

另外有一些区块链系统，当铸币到一定总量后，系统以维持一个适度的通胀率缓慢发行新币，这样通胀铸币就和交易费一起成为系统长期运行的驱动力。还有一些系统仅以通胀铸币为驱动力，免除了用户的交易费。但无论如何，系统都需要经济上的驱动因子，这就是公链上不可或缺的激励机制。



## 原始铸币

类似于Bitcoin，本设计中的铸币是在漫长的时间延续中逐步发行。规则如下：

- 原始币量：50币/块（致敬Bitcoin）。
- 出块间隔：6分钟。这是一个固定值。
- 递减算法：逐年递减10%。即前一年的90%，精确到币单位（而不是聪）。
- 发行时长：需要20年递减到3币/块，然后长期固定为该铸币量。
- 总发行量：34,626,095币 + 长期微通胀。

> **注：**<br>
> 采用恒星年（365日6时9分）记年，因此每年按创建 `87661` 个区块计算。<br>

```go
年次    累计            （占比）        币量/块
------------------------------------------------
1       4383050         (12.56%)        50
2       8327795         (23.86%)        45
3       11834235        (33.91%)        40
4       14990031        (42.96%)        36
5       17795183        (51%)           32
6       20249691        (58.04%)        28
7       22441216        (64.32%)        25
8       24369758        (69.84%)        22
9       26035317        (74.62%)        19
10      27525554        (78.89%)        17
11      28840469        (82.66%)        15
12      29980062        (85.92%)        13
13      30944333        (88.69%)        11
14      31733282        (90.95%)        9
15      32434570        (92.96%)        8
16      33048197        (94.72%)        7
17      33574163        (96.23%)        6
18      34012468        (97.48%)        5
19      34363112        (98.49%)        4
20      34626095        (99.24%)        3
...     // 3币/块长期微通胀机制，通胀率 <0.76% 自然衰减
```



## 通胀铸币

通胀铸币是在原始铸币结束之后，系统继续以一个微小的通胀率长期发行新币。之所以需要后期的通胀设计，是因为仅仅依靠交易费来维持矿工的积极性可能是一个问题。后期的通胀铸币其实是向全网征税，如果额度合适就是合理的。

后期的微通胀铸币被用来补充矿工的收益，考虑简单性和稳定的预期，本设计采用后期 **每区块3币** 的固定额发行方式。

> **参考：**<br>
> 上面固定发币量的通胀设计是在交易费全额回收的情况下实施，可以考虑另一种设计：
> - 交易费只回收**50%**。
> - 每区块发币量增加为**4**个币（即上面时间表中第20年初就开始执行）。
>
> 这样的设计增加了一个市场变量：*50%的交易费被销毁*。
> 因此：
> 1. 当交易量增加、交易费变多时，销毁的币也变多。效果：币总量减少促使币值上升，抑制交易或交易费。
> 2. 当交易量减少、交易费变少时，销毁的币也减少。效果：币总量回升促使币值下跌，促进交易或交易费支付。
>
> 这是一种与外部市场的交互，增加的灵活性或许可以让系统更容易自平衡。


## 公共服务的激励

公共服务分离出了区块链系统的基本需求，它们应当参与到区块链的利益分配里去，这是一个顺理成章的逻辑。但这些公共服务是P2P的去中心化模式，一个逻辑严密的利益分配机制可能很难实现，因此这里采用了一个松散的利益报偿设计：**铸造者收益的 `50%` 分配给公共服务**。


### 铸币交易的结构

区块的铸造收益在Coinbase交易里体现，这是一个特殊的交易，包含了原始铸币、交易费提取等情况。与Bitcoin不同，这里的Coinbase交易还负责对外部公共服务的奖励配置和发放（遵循固定的规则）。

交易的基本结构（示意）如下：

```go
Coinbase: {
    // 版本和时间戳在交易头里

    // 资金区
    Coins     uint64        // 收益总额（铸币、交易费、兑奖截留）
    CoinSelf  [2]*TxOut     // 铸造收益（铸造者，分成者）。约束：总额的50%
    AwardTo   [3]*AwardOut  // 外部奖励（Findings, Blockqs, Archives）。约束：总额的50%
    DrawSlot  [90]byte      // 兑奖槽（3*240 = 720位）

    // 配置区
    Config    ConfSet       // 铸造者认为合适的激励配比（投票）
    ConfEnd   ConfSet       // 前阶配置统计结论，后续执行

    // 铸造相关
    Meriter   [2][]byte     // 择优凭证信息存储
    Minter    []byte        // 铸造者相关信息（引用/签名等）
}
```

**说明：**
对公共服务的外部奖励配比应该在系统中硬编码明确下来，这里设计为按总额的50%平分。各个不同服务的内在配比由 `Config` 字段动态配置，如前所述，这些动态配置是一些受限的微调值，并且要求修改配置的铸造者达到一定数量才有效。


### 可能随意的局部评估

对公共服务节点的奖励需要一种抽奖机制，但公共服务是一个开放的P2P网络。如果让服务器提供某种证明来参与竞争，就需要创建一套防止作弊的可信机制，而这恰恰是区块链本身要解决的问题。设计一套基本可靠的方案既复杂成本也高，因此，这里的做法十分简单：

**区块的铸造者可以随意选择获奖者。没有抽奖！**

这里没有任何限制，铸造者可以选择自己的服务商或其它服务商，或者它们甚至都不是服务。乍一看这好像很荒唐……

奖励的选择是没有限制，但兑奖不是。获奖者并不能简单地把奖金拿走，奖金的提取需要得到后续其他铸造者的认可。

兑奖规则为：在后续32个区块内，至少需要得到一位铸造者的确认，确认数越多，提取的比例就越大。具体如下：

```go
确认数  兑现比例
------------------
1       25%
2       50%
3       75%
4       100%
```

后续铸造者对前期奖励的确认在其铸币交易里的「兑奖槽」里标记。每一个铸造者需要对前30个区块内的奖励目标进行评估：**如果目标曾经是自己连接并交互良好的公共服务节点，则认可该笔奖励**（兑奖槽内位标记），否则不予承认。每个区块的外部奖励为3个服务者，32个区块共计96位，占用12字节。

如果服务节点因为比较少的确认数未能提取全部奖金，截留部分将由下一个评估段（32块之后）的对应块回收。回收的金额会作为铸币收益的一部分，一起参与到按比例的正常分配。


### 局部评估的合理性

由于兑奖的约束，铸造者的随意选择其实并非真正的随意，奖励给一个并不提供服务的私人地址没有用，因为其它铸造者不会知道它，而如果选择一个自己开设的服务，其实没啥可说的，因为提供了服务，而且效率和知名度也需要付出。当然，这对仅仅提供公共服务却没有参与铸造的人来说有些不公，这确实是一种遗憾，事无完美。

提供良好公共服务的节点会被铸造者记住并缓存，如果铸造者奖励自己并不高效的服务器，确认数可能就不高，奖金会被截留。而如果某个专业的公共服务器强大并被很多节点喜欢，它的奖金兑现比例就应该问题不大。

P2P的逻辑是松散的，一个节点对周围节点的感知并不多，如果公共服务的节点很多，应用节点通常是就近连接，所以铸造者感知的服务节点也不会有太大的交集，因此上面设计的确认数不高。局部范围是存在的，一个局部范围内可能存在某个固定的优势服务器从而形成垄断，但铸造者是自由的。

源于铸造者的随机性、评估的自由、以及局部范围本身的动态变化，可以认为全网范围内的奖励目标也是随机的。

> **注：**<br>
> 这种评估受限于铸造者对服务节点的观察范围，而不是在全网范围内衡量，因此称之为局部评估。<br>


#### 附：节点评估的缓存池规模

P2P公共服务网络的规模可能很大，这样服务节点就会非常地离散，节点需要对提供过服务的节点进行缓存，从而实现足够的确认行为。

这里假设服务网络的规模是1,000个节点，32个区块按最高4次确认，缓存池的大小估算如下：

- **命中率**：`32/4 = 8` （即每1个确认需要由8个区块来命中）。
- **等效集**：`1000/8 = 125` （保持相同的命中率需要的集合大小）。
- **池大小**：设定冗余度为1.5，缓存池大小为 `125 x 1.5 ≈ 188`。

这是一个简单的估算，在实际运行中我们可以适当扩大缓存池中良好服务节点的记忆量（如 `300 ~ 600`）。如果服务节点的网络规模变大（由确认数看出来），节点可以调整记忆量。



-------------------------------------------------------------------------------

上一篇：[公共服务](3.公共服务.md)<br>
下一篇：[脚本系统设计](5.脚本系统设计.md)<br>
